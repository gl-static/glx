(self.webpackChunkchatting_webapp=self.webpackChunkchatting_webapp||[]).push([[865],{48865:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>C}),n(4723);var o=n(37703),i=n(14890),r=n(44103),s=n(70493),a=n(42560),c=n(89980),u=n(89262),d=n(59930),l=n(74935),p=n(45697),h=n.n(p),m=n(67294),f=n(5977),w=n(81249),b=n.n(w),v=n(80722),g=n(73476),O=n(34288),E=n(58008),L=n(47470),y=n(19476),U=n(58367),k=n(72009),S=n(58194),T=n(91384);function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const j=k.Z.dispatch,A=k.Z.getState;class R extends m.PureComponent{constructor(e){super(e),_(this,"onDesktopMessageListener",(({origin:e,data:{type:t,message:n={}}={}}={})=>{if(this.props.currentUser&&e===window.location.origin)switch(t){case"register-desktop":{const{version:e}=n;window.desktop||(window.desktop={}),window.desktop.version=b().valid(b().coerce(e));break}case"user-activity-update":{const{userIsActive:e,manual:t}=n;!0!==e&&!1!==e||S.Z.userUpdateActiveStatus(e,t);break}case"notification-clicked":{const{channel:e,teamId:t}=n;window.focus(),this.props.actions.getChannelURLAction(e,t);break}}})),_(this,"handleBackSpace",(e=>{8!==e.which||["input","textarea"].includes(e.target.tagName.toLowerCase())||e.preventDefault()})),_(this,"handleBeforeUnload",(()=>{window.removeEventListener("beforeunload",this.handleBeforeUnload),document.cookie.indexOf("".concat(g.Z.COOKIE.SESSION_USER,"="))>-1&&(0,v.SU)("",this.props.currentChannelId||"")(j,A),E.xv()}));const t=document.getElementById("root");t&&(t.className+=" channel-view")}isValidState(){return null!=this.props.currentUser}componentDidMount(){let e=screen.availWidth||screen.width,t=screen.availHeight||screen.height;e>t&&(t+=e,e=t-t,t-=e);const n=t/e<1.8;if(E.j2(),this.props.enableTimezone&&this.props.actions.autoUpdateTimezone((0,U.x_)()),window.addEventListener("beforeunload",this.handleBeforeUnload),window.addEventListener("focus",this.onFocusListener),window.addEventListener("blur",this.onBlurListener),document.hasFocus()||O.UF(!1),window.addEventListener("message",this.onDesktopMessageListener),window.postMessage({type:"webapp-ready"},window.location.origin),L.s()?(document.body.classList.add("ios"),n&&document.body.classList.add("ios-old")):L.Dt()&&document.body.classList.add("android"),!this.props.currentUser){const e=document.getElementById("root");e&&e.setAttribute("class",""),O.gc("/login?redirect_to="+encodeURIComponent(this.props.location.pathname),!0,!1)}window.addEventListener("keydown",this.handleBackSpace),this.isValidState()&&T.Z.signalLogin()}componentWillUnmount(){E.xv(),window.removeEventListener("keydown",this.handleBackSpace),window.removeEventListener("focus",this.onFocusListener),window.removeEventListener("blur",this.onBlurListener),window.removeEventListener("message",this.onDesktopMessageListener)}render(){if(!this.isValidState())return m.createElement(y.Z,null);if(this.props.mfaRequired){if("/mfa/setup"!==this.props.location.pathname)return m.createElement(f.l_,{to:"/mfa/setup"})}else if("/mfa/confirm"===this.props.location.pathname);else if(this.props.showTermsOfService&&"/terms_of_service"!==this.props.location.pathname)return m.createElement(f.l_,{to:"/terms_of_service?redirect_to="+encodeURIComponent(this.props.location.pathname)});return this.props.children}onFocusListener(){O.UF(!0)}onBlurListener(){O.UF(!1)}}_(R,"propTypes",{currentUser:h().object,currentChannelId:h().string,children:h().object,mfaRequired:h().bool.isRequired,enableTimezone:h().bool.isRequired,actions:h().shape({autoUpdateTimezone:h().func.isRequired,getChannelURLAction:h().func.isRequired}).isRequired,showTermsOfService:h().bool.isRequired});const z=(e,t)=>(n,o)=>u.m.push((0,l.qr)(o(),e,t)),C=(0,o.connect)((function(e,t){const n=(0,a.lJ)(e),o=(0,a.iE)(e),i=(0,c.YE)(e);return{currentUser:(0,c.ts)(e),currentChannelId:(0,s.gO)(e),mfaRequired:(0,d.b2)((0,c.ts)(e),n,o,t.match.url),enableTimezone:"true"===o.ExperimentalTimezone,showTermsOfService:i}}),(function(e){return{actions:(0,i.bindActionCreators)({autoUpdateTimezone:r.g,getChannelURLAction:z},e)}}))(R)},44103:(e,t,n)=>{"use strict";n.d(t,{g:()=>u}),n(88674);var o=n(89980),i=n(76938),r=n(18493);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){return async(t,n)=>{const s=(0,o.ts)(n()),c=(0,i.S)(n(),s.id),u=c.automaticTimezone!==e;if(c.useAutomaticTimezone&&u){const o={useAutomaticTimezone:"true",automaticTimezone:e,manualTimezone:c.manualTimezone},i=a(a({},s),{},{timezone:o});(0,r.DO)(i)(t,n)}}}},59930:(e,t,n)=>{"use strict";n.d(t,{b2:()=>a});var o=n(92337),i=n(74935);o.vU.PAGE_NOT_FOUND;const r=["/mfa/setup","/mfa/confirm"],s=["","email","ldap"];function a(e,t,n,o){if("true"===t.MFA&&"true"===n.EnableMultifactorAuthentication&&"true"===n.EnforceMultifactorAuthentication&&-1===r.indexOf(o)){if((0,i.a_)(e)&&"true"!==n.GuestAccountsEnforceMultifactorAuthentication)return!1;if(e&&!e.mfa_active&&-1!==s.indexOf(e.auth_service))return!0}return!1}}}]);